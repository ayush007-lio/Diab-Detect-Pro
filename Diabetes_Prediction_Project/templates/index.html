<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diabetes Predictor AI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>

    <div class="container" id="main-content">
        <div class="header">
            <h1>Diabetes Prediction AI</h1>
            <p>Enter your health metrics for an assessment.</p>
        </div>

        <form action="{{ url_for('predict')}}" method="post">
            
            <div class="input-group full-width">
                <label>Patient Name</label>
                <input type="text" name="name" placeholder="Enter full name" 
                       value="{{ form_data['name'] if form_data else '' }}" required>
            </div>

            <div class="input-grid">
                <div class="input-group">
                    <label>Pregnancies</label>
                    <input type="number" name="pregnancies" placeholder="0" 
                           value="{{ form_data['pregnancies'] if form_data else '' }}" required>
                </div>
                <div class="input-group">
                    <label>Glucose Level</label>
                    <input type="number" name="glucose" placeholder="120" 
                           value="{{ form_data['glucose'] if form_data else '' }}" required>
                </div>
                <div class="input-group">
                    <label>Blood Pressure</label>
                    <input type="number" name="bloodpressure" placeholder="70" 
                           value="{{ form_data['bloodpressure'] if form_data else '' }}" required>
                </div>
                <div class="input-group">
                    <label>Skin Thickness</label>
                    <input type="number" name="skinthickness" placeholder="20" 
                           value="{{ form_data['skinthickness'] if form_data else '' }}" required>
                </div>
                <div class="input-group">
                    <label>Insulin Level</label>
                    <input type="number" name="insulin" placeholder="79" 
                           value="{{ form_data['insulin'] if form_data else '' }}" required>
                </div>
                <div class="input-group">
                    <label>BMI</label>
                    <input type="number" step="0.1" name="bmi" placeholder="25.5" 
                           value="{{ form_data['bmi'] if form_data else '' }}" required>
                </div>
                <div class="input-group">
                    <label>Diabetes Pedigree</label>
                    <input type="number" step="0.001" name="dpf" placeholder="0.5" 
                           value="{{ form_data['dpf'] if form_data else '' }}" required>
                </div>
                <div class="input-group">
                    <label>Age</label>
                    <input type="number" name="age" placeholder="30" 
                           value="{{ form_data['age'] if form_data else '' }}" required>
                </div>
            </div>

            <button type="submit" class="btn">Predict Now</button>
        </form>

        {% if result %}
        <div class="result-box {{ result_class }}">
            <h3>{{ result }}</h3>
            <p>{{ advice }}</p>
            <button onclick="downloadPDF()" class="pdf-btn">Download PDF Report</button>
        </div>
        {% endif %}
    </div>

    {% if result %}
    <div id="report-template" style="display: none;">
        <div class="pdf-container">
            <div class="pdf-header">
                <h2>Medical Prediction Report</h2>
                <p>Generated by AI Diabetes Assistant</p>
                <hr>
            </div>
            
            <div class="pdf-details">
                <p><strong>Patient Name:</strong> {{ name }}</p>
                <p><strong>Date:</strong> {{ date }}</p>
            </div>

            <table class="pdf-table">
                <tr><th>Metric</th><th>Value</th></tr>
                <tr><td>Pregnancies</td><td>{{ form_data['pregnancies'] }}</td></tr>
                <tr><td>Glucose Level</td><td>{{ form_data['glucose'] }}</td></tr>
                <tr><td>Blood Pressure</td><td>{{ form_data['bloodpressure'] }}</td></tr>
                <tr><td>Skin Thickness</td><td>{{ form_data['skinthickness'] }}</td></tr>
                <tr><td>Insulin Level</td><td>{{ form_data['insulin'] }}</td></tr>
                <tr><td>BMI</td><td>{{ form_data['bmi'] }}</td></tr>
                <tr><td>Pedigree Function</td><td>{{ form_data['dpf'] }}</td></tr>
                <tr><td>Age</td><td>{{ form_data['age'] }}</td></tr>
            </table>

            <div class="pdf-result {{ result_class }}">
                <h3>Result: {{ result }}</h3>
                <p>{{ advice }}</p>
            </div>
            
            <div class="pdf-footer">
                <p><small>Disclaimer: This is an AI-generated prediction and not a substitute for professional medical diagnosis.</small></p>
            </div>
        </div>
    </div>
    {% endif %}

    <script>
        function downloadPDF() {
            const element = document.getElementById('report-template');
            
            // Make it visible temporarily for the PDF generation
            element.style.display = 'block';

            var opt = {
                margin:       0.5,
                filename:     '{{ name }}_Diabetes_Report.pdf',
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2 },
                jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
            };

            // Generate PDF and then hide the element again
            html2pdf().set(opt).from(element).save().then(function(){
                element.style.display = 'none';
            });
        }
    </script>
</body>
</html>